[[_TOC_]]

# 可読性
## 概要
可読性は高品質なコードの条件といえる。
- 可読性の低いコードが
  - 保守しやすいことはない。
  - 拡張しやすいことはない。
  - テストしやすいことはない。
  - 開発を楽しくすることはない。
- コード全体の可読性が高く保たれたシステムは、
  - 上記とは逆に、自然に一定の保守性、拡張性、テスト可能性を備える。
    - バグが混入しにくい。
    - 経年劣化 (秘伝のたれ化) しにくい。
    - ドキュメントが最小限で済む (コードが自己ドキュメント化されている)。
  - 新規参入者にとってなじみやすい。
  - 経験の浅いメンバーがコードから多くを学ぶことができる。
  - 関わっていて嬉しい。
    - チームの士気を保ちやすい。
    - 優秀な新規参入者に逃げられにくい。
  - :arrow_right: 短期的、長期的にあらゆる面で開発コスト低減に寄与する。

## 可読性の高いコードとは
### 単独のコードとして
- パッと見た瞬間、すっきりしている。
  - 直観的に「読みたくない」と感じさせない。
  - ネストが深くない。
  - メソッドがコンパクト。
  - 適切な改行や空行挿入など、レイアウトの工夫により見た目にもメリハリがある。

- 実際に読んだとき、理解しやすい。
  - ロジックが整理されている。
    - コードが短い。
    - シンプルに書かれている。
      - 余計なことをしていない。
        - 冗長な処理
        - コードを短くするための無理な書き方  
        など...
      - 慣用的な書き方を優先している。
      - 適切なガード節の使用により、考えなくてよいことが明確になっている。
  - コードの意図が見える。
    - クラス、メソッド、変数などに適切な名前がつけられている。
      - 「名は体を表して」いる。
        - 「それが何なのか」に関するコメントが必要ない。
      - 名前がコードの説明にもなっている。
      - おかしな英語を使っていない。
    - 必要かつ十分なコメントが書かれている。
      - なぜそのような処理をしているかが説明されている。
        - 特殊なケースの考慮
        - 利用ライブラリの仕様による事情
        - 自身の仕様による事情  
        など...
      - 見ればわかるような自明な情報がコメントされていない。
        - 意味のある値に対して適切な名前の変数を用意している。
      - 重要な処理情報をログ出力することにより、コメントを回避しつつ説明できている。

### 全体として
- 一貫性がある
  - 共通のルールに従っており、バラつきが少ない。
    - レイアウトの仕方
    - 名前の付け方
      - 記法
      - 単語の選択
    - クラスや処理の分割方針
      - フレームワーク
      - アーキテクチャ
    - コードの書き方
      - 構文や言語機能の選択
      - イディオムの使用
      - パターンの使用
  - 仕様とコードの対応が明らかである。
    - 各々の要素の役割がはっきりしている。

# テストしやすさ
## 概要
テストしやすいコードを書くことは、当然のことながらテストを書くために必要である。  
近年注目されているCI/CDを実現するには、テストコードの存在が必須である。
- テストの存在により、コード修正時の単体レベルの動作確認を自動化することができる。
  - 工数削減
  - デグレードの検出
  - 再現性
    - テストが正しければ必ず正しい結果が得られる
- テストコードは仕様をコードで表現するドキュメントとしても機能する。
  - ドキュメントの削減

### 可読性との関係
- テストしやすいコードには可読性の高さが要求される。
  - 読めないコードのテストは誰も書けない!
- 逆に、コードのテストしやすさが増すと、通常は可読性も向上する。  
:arrow_right: テストしやすいコードは、可読性の高いコードのサブセットである。

## テストしやすいコードとは
- [各クラスの凝集度が高い。](https://ja.wikipedia.org/wiki/%E5%87%9D%E9%9B%86%E5%BA%A6)
  - クラスの役割がはっきりしている
    - テストすべき処理が明確である。
    - 無関係なクラスがテスト
- [クラス同士の結合度が低い。](https://ja.wikipedia.org/wiki/%E7%B5%90%E5%90%88%E5%BA%A6)
  - クラス間の依存が弱いため、テスト対象のクラスを準備するために他の複雑なクラスをいろいろ調整しなくてよい。
  - 依存性注入が適切に行われている。
    - テストスタブ注入により、純粋に目的のメソッドのコードのみを対象としたテストが実施できる。
- クラスもメソッドもコンパクトである。
  - 高凝集かつ低結合なコードを書くことにより通常、自然に実現される。
  - コードがシンプルで分岐、ループ、ネストが最小限しかない。
    - テストすべきパターンの網羅 (カバレッジ) が楽である。  
      (ネストするごとにパターンは掛け算で増加する!)
  - privateメソッドが少ない
    - テストが複雑にならない。  
      (publicメソッドを通したprivateメソッドのテストは、否が応にも複雑になる)
    

# 保守性と拡張性
## 概要
保守性と拡張性は、コードの品質を保ちつつ不具合修正や仕様変更への対応を  
長期間続けていくために重要である。

- 実績のあるフレームワークやアーキテクチャを採用することが非常に効果的である。
  - フレームワークやアーキテクチャはそもそも保守性、拡張性を主要な課題として  
    設計されている。
  - そのフレームワークやアーキテクチャの経験者であればスムーズに新規参入できる。
- コードに一定以上の保守性、拡張性がある場合には、それらを向上させるための改修を  
  行うことが可能となる。  
  :arrow_right: 水準を下回ってしまわないよう、品質向上を目的とした保守を定期的に実施することが重要。
  - 技術的負債の返済 (リファクタリング)
  - 最新技術の採用

### 可読性との関係
- 保守性、拡張性の高いコードには可読性の高さが要求される。
  - 読めないコードには誰も手を入れることができない!
- 逆に、コードの保守性、拡張性が高くなると、通常は可読性も向上する。  
:arrow_right: 保守性、拡張性の高いコードは、可読性の高いコードのサブセットである。

### テストしやすさとの関係
- 保守性、拡張性の高いコードにはテストしやすいことが要求される。
  - テストの存在が保守と拡張の作業の安全を担保する。
  - テストがないコードの変更はデグレードのリスクが高い!
- 逆に、コードの保守性、拡張性が高くなると、通常はテストのしやすさも向上する。  
:arrow_right: 保守性、拡張性の高いコードは、テストしやすいコードのサブセットである。

## 保守性と拡張性の高いコードとは
:warning: 以下はテストしやすいコードと一部重複している。
- クラスのモジュール性が高い。
  - 個々のクラスやメソッドの役割が明確である。
    - それぞれがコンパクトにできている。
      - 可読性が高い。
      - テストしやすい。
    - モジュール同士の独立性が高い。
      - 改修時にやるべきことが明確である。
        - どこを変更すべきか。
        - 変更がどこに影響するか。
      - テストしやすい。
  - コードが再利用できる。
    - 特定の機能を丸ごと差し替えるといった対応が可能。
      - 機能拡張も実現できる。
    - 設定ファイルなどを利用してノンコーディングでシステムの挙動を変更できる。
    - 同じような修正を何か所も行わなくてよい。
    - 修正漏れのリスクが低い。
    - テスト側での修正対応が最小限で済む。

# 参考 : ダメなコードについて
ダメなコードについて知ることも大変重要です :spaghetti:
- [本当にあった怖いプログラム（クソコード事例集）](https://axia.co.jp/2018-04-27)  
- ["ダメなコード" での検索結果](https://www.google.com/search?q=%E3%83%80%E3%83%A1%E3%81%AA%E3%82%B3%E3%83%BC%E3%83%89&rlz=1C1GCEU_jaJP860JP860&oq=%E3%83%80%E3%83%A1%E3%81%AA%E3%82%B3%E3%83%BC%E3%83%89&aqs=chrome..69i57j0l7.7017j1j8&sourceid=chrome&ie=UTF-8)